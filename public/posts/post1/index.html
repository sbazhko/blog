<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>All You Need to Know About Caches | Sergei Bozhko</title>
<meta name="keywords" content="">
<meta name="description" content="What are eviction policies? How do you pick the right caching strategy?">
<meta name="author" content="Level: Easy">
<link rel="canonical" href="http://localhost:1313/posts/post1/">
<meta name="google-site-verification" content="XYZabc">
<meta name="yandex-verification" content="XYZabc">
<meta name="msvalidate.01" content="XYZabc">
<link crossorigin="anonymous" href="/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css" integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/images/win.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/images/win.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/images/win.jpg">
<link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/post1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/post1/">
  <meta property="og:site_name" content="Sergei Bozhko">
  <meta property="og:title" content="All You Need to Know About Caches">
  <meta property="og:description" content="What are eviction policies? How do you pick the right caching strategy?">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-10-22T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-10-22T00:00:00+00:00">
    <meta property="og:image" content="http://localhost:1313/awscover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/awscover.png">
<meta name="twitter:title" content="All You Need to Know About Caches">
<meta name="twitter:description" content="What are eviction policies? How do you pick the right caching strategy?">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "All You Need to Know About Caches",
      "item": "http://localhost:1313/posts/post1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "All You Need to Know About Caches",
  "name": "All You Need to Know About Caches",
  "description": "What are eviction policies? How do you pick the right caching strategy?",
  "keywords": [
    
  ],
  "articleBody": "Introduction üåü How do you boost the performance of your system? How do you pass a system design interview? The answer to both lies in mastering caching. Caches are one of the key components in system design, capable of making software run much faster at every level.\nBut when do you actually need a cache? What are eviction policies? How do you pick the right caching strategy?\nBy the end of this guide, you will know how to use caches effectively and avoid common mistakes.\nWhat is a Cache? ü§î A cache is a storage layer designed to keep frequently used data, reducing the need to fetch it from slower storage repeatedly.\nExample: Browser Caching üåê When you load a webpage for the first time, it may take some time, especially on a slow internet connection. However, subsequent visits are often much faster because the browser caches assets like images and scripts locally. This eliminates the need to download them again.\nThe problem caching solves is performance.\nScenarios Where Caching Is Useful üí° Complex Database Queries: Results from JOIN operations across multiple tables can be cached to avoid re-executing time-consuming queries. Post-Processing Tasks: Outputs from multi-step processes can be cached to avoid redundant calculations. Large Data Transfers: Frequently accessed network data can be cached closer to the client to reduce latency. Web Applications: A cache between the client and the database reduces load times by storing results of common queries. The efficiency of a cache is measured by its hit ratio, the percentage of cache hits among all service requests.\nWhen to Use (or Avoid) a Cache ‚öñÔ∏è Caching is not always the answer. Consider these points:\nWhen Not to Use Caching:\nYour system has no performance issues. Your data changes constantly, making cache updates frequent and costly. Your data is sensitive, like passwords or financial information, where caching could pose risks. When to Use Caching:\nSystems with repetitive data access patterns. Applications where reducing latency or computational overhead is critical. Types of Caches üóÇÔ∏è Hardware Caches üñ•Ô∏è Hardware caches are built into the CPU and are extremely fast. They store frequently accessed data close to the processor:\nL1 Cache: Smallest and fastest, located closest to the CPU core. L2 and L3 Caches: Larger but slower. Translation Lookaside Buffer (TLB): Maps virtual to physical memory addresses quickly. Software Caches üìÇ Page Cache üßæ The operating system uses a page cache to store disk data in RAM. This reduces the need to repeatedly access slower storage.\nWeb Caching üåé Client-Side Caching: Web browsers cache assets like images and scripts. This is controlled by HTTP headers such as:\nmax-age: Specifies how long to cache data. no-store: Prevents caching, typically for sensitive data. Shared Caching: Proxy servers and CDNs (Content Delivery Networks) serve multiple users by storing frequently accessed content closer to them.\nProxy Servers: Reduce server load by caching popular data. CDNs: Improve response times by storing content geographically closer to users. Application-Level Caches üõ†Ô∏è Database Caching: Includes query results, indexes, and materialized views. Memoization: Caches the results of expensive function calls, useful in dynamic programming. Deployment Models üöÄ Caches can be deployed as:\nIn-Memory: Fast, as data resides in RAM. Examples include Memcached and Redis. Distributed: For scalability and fault tolerance, data is distributed across multiple nodes. Cache Management üõ°Ô∏è Eviction Policies üö™ When cache memory is full, items must be evicted. Common strategies include:\nLeast Recently Used (LRU): Removes the least recently accessed item. First-In-First-Out (FIFO): Removes the oldest entry. Least Frequently Used (LFU): Removes the least accessed item. Caching Strategies üß© Inline Caches üõ§Ô∏è Read-Through: Cache retrieves data from storage on a miss and serves it to the client. Write-Through: Updates are written to both the cache and storage simultaneously. Write-Back: Updates are written to the cache first and later synced to storage, offering better write performance but weaker consistency. Side Caches üõ†Ô∏è Cache-Aside: The application explicitly manages cache reads and writes. Write-Around: Data is written directly to storage without updating the cache, suitable for rarely updated data. Common Challenges üõë Thundering Herd Problem üêò Occurs when multiple clients overwhelm the system after a cache miss. Solutions include:\nCache Warm-Up: Pre-load frequently accessed data. Soft and Hard TTL: Extend cache validity with soft TTL to avoid simultaneous cache expirations. Cache Penetration üö´ Happens when requests repeatedly query non-existent data. Solutions include negative caching to store ‚Äúnon-existent‚Äù responses temporarily.\nHot Key Problem üî• A single, heavily accessed cache entry can overwhelm a single node. Solutions include sharding the cache or using distributed caching.\nCaching is a critical tool in system design that can significantly enhance performance when applied correctly. Understanding where, when, and how to use caching will help you optimize systems and ace system design interviews.\n",
  "wordCount" : "787",
  "inLanguage": "en",
  "image":"http://localhost:1313/awscover.png","datePublished": "2024-10-22T00:00:00Z",
  "dateModified": "2024-10-22T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "Level: Easy"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/post1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sergei Bozhko",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/images/win.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">
                <img src="http://localhost:1313/apple-touch-icon.png" alt="" aria-label="logo"
                    height="35">Home</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/categories/" title="Articles">
                    <span>Articles</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      All You Need to Know About Caches
    </h1>
    <div class="post-meta"><span title='2024-10-22 00:00:00 +0000 UTC'>October 22, 2024</span>&nbsp;¬∑&nbsp;4 min&nbsp;¬∑&nbsp;787 words&nbsp;¬∑&nbsp;Level: Easy

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="http://localhost:1313/awscover.png" alt="caches">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction-">Introduction üåü</a></li>
    <li><a href="#what-is-a-cache-">What is a Cache? ü§î</a>
      <ul>
        <li><a href="#example-browser-caching-">Example: Browser Caching üåê</a></li>
        <li><a href="#scenarios-where-caching-is-useful-">Scenarios Where Caching Is Useful üí°</a></li>
      </ul>
    </li>
    <li><a href="#when-to-use-or-avoid-a-cache-">When to Use (or Avoid) a Cache ‚öñÔ∏è</a></li>
    <li><a href="#types-of-caches-">Types of Caches üóÇÔ∏è</a>
      <ul>
        <li><a href="#hardware-caches-">Hardware Caches üñ•Ô∏è</a></li>
        <li><a href="#software-caches-">Software Caches üìÇ</a></li>
        <li><a href="#application-level-caches-">Application-Level Caches üõ†Ô∏è</a></li>
      </ul>
    </li>
    <li><a href="#deployment-models-">Deployment Models üöÄ</a></li>
    <li><a href="#cache-management-">Cache Management üõ°Ô∏è</a>
      <ul>
        <li><a href="#eviction-policies-">Eviction Policies üö™</a></li>
        <li><a href="#caching-strategies-">Caching Strategies üß©</a></li>
      </ul>
    </li>
    <li><a href="#common-challenges-">Common Challenges üõë</a>
      <ul>
        <li><a href="#thundering-herd-problem-">Thundering Herd Problem üêò</a></li>
        <li><a href="#cache-penetration-">Cache Penetration üö´</a></li>
        <li><a href="#hot-key-problem-">Hot Key Problem üî•</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction-">Introduction üåü<a hidden class="anchor" aria-hidden="true" href="#introduction-">#</a></h2>
<p>How do you boost the performance of your system? How do you pass a system design interview? The answer to both lies in mastering caching. Caches are one of the key components in system design, capable of making software run much faster at every level.</p>
<p>But when do you actually need a cache? What are eviction policies? How do you pick the right caching strategy?</p>
<p>By the end of this guide, you will know how to use caches effectively and avoid common mistakes.</p>
<h2 id="what-is-a-cache-">What is a Cache? ü§î<a hidden class="anchor" aria-hidden="true" href="#what-is-a-cache-">#</a></h2>
<p>A cache is a storage layer designed to keep frequently used data, reducing the need to fetch it from slower storage repeatedly.</p>
<h3 id="example-browser-caching-">Example: Browser Caching üåê<a hidden class="anchor" aria-hidden="true" href="#example-browser-caching-">#</a></h3>
<p>When you load a webpage for the first time, it may take some time, especially on a slow internet connection. However, subsequent visits are often much faster because the browser caches assets like images and scripts locally. This eliminates the need to download them again.</p>
<p>The problem caching solves is <strong>performance</strong>.</p>
<h3 id="scenarios-where-caching-is-useful-">Scenarios Where Caching Is Useful üí°<a hidden class="anchor" aria-hidden="true" href="#scenarios-where-caching-is-useful-">#</a></h3>
<ol>
<li><strong>Complex Database Queries</strong>: Results from JOIN operations across multiple tables can be cached to avoid re-executing time-consuming queries.</li>
<li><strong>Post-Processing Tasks</strong>: Outputs from multi-step processes can be cached to avoid redundant calculations.</li>
<li><strong>Large Data Transfers</strong>: Frequently accessed network data can be cached closer to the client to reduce latency.</li>
<li><strong>Web Applications</strong>: A cache between the client and the database reduces load times by storing results of common queries.</li>
</ol>
<p>The efficiency of a cache is measured by its <strong>hit ratio</strong>, the percentage of cache hits among all service requests.</p>
<h2 id="when-to-use-or-avoid-a-cache-">When to Use (or Avoid) a Cache ‚öñÔ∏è<a hidden class="anchor" aria-hidden="true" href="#when-to-use-or-avoid-a-cache-">#</a></h2>
<p>Caching is not always the answer. Consider these points:</p>
<ul>
<li>
<p><strong>When Not to Use Caching:</strong></p>
<ul>
<li>Your system has no performance issues.</li>
<li>Your data changes constantly, making cache updates frequent and costly.</li>
<li>Your data is sensitive, like passwords or financial information, where caching could pose risks.</li>
</ul>
</li>
<li>
<p><strong>When to Use Caching:</strong></p>
<ul>
<li>Systems with repetitive data access patterns.</li>
<li>Applications where reducing latency or computational overhead is critical.</li>
</ul>
</li>
</ul>
<h2 id="types-of-caches-">Types of Caches üóÇÔ∏è<a hidden class="anchor" aria-hidden="true" href="#types-of-caches-">#</a></h2>
<h3 id="hardware-caches-">Hardware Caches üñ•Ô∏è<a hidden class="anchor" aria-hidden="true" href="#hardware-caches-">#</a></h3>
<p>Hardware caches are built into the CPU and are extremely fast. They store frequently accessed data close to the processor:</p>
<ul>
<li><strong>L1 Cache</strong>: Smallest and fastest, located closest to the CPU core.</li>
<li><strong>L2 and L3 Caches</strong>: Larger but slower.</li>
<li><strong>Translation Lookaside Buffer (TLB)</strong>: Maps virtual to physical memory addresses quickly.</li>
</ul>
<h3 id="software-caches-">Software Caches üìÇ<a hidden class="anchor" aria-hidden="true" href="#software-caches-">#</a></h3>
<h4 id="page-cache-">Page Cache üßæ<a hidden class="anchor" aria-hidden="true" href="#page-cache-">#</a></h4>
<p>The operating system uses a <strong>page cache</strong> to store disk data in RAM. This reduces the need to repeatedly access slower storage.</p>
<h4 id="web-caching-">Web Caching üåé<a hidden class="anchor" aria-hidden="true" href="#web-caching-">#</a></h4>
<p><strong>Client-Side Caching</strong>: Web browsers cache assets like images and scripts. This is controlled by HTTP headers such as:</p>
<ul>
<li><code>max-age</code>: Specifies how long to cache data.</li>
<li><code>no-store</code>: Prevents caching, typically for sensitive data.</li>
</ul>
<p><strong>Shared Caching</strong>: Proxy servers and CDNs (Content Delivery Networks) serve multiple users by storing frequently accessed content closer to them.</p>
<ul>
<li><strong>Proxy Servers</strong>: Reduce server load by caching popular data.</li>
<li><strong>CDNs</strong>: Improve response times by storing content geographically closer to users.</li>
</ul>
<h3 id="application-level-caches-">Application-Level Caches üõ†Ô∏è<a hidden class="anchor" aria-hidden="true" href="#application-level-caches-">#</a></h3>
<ol>
<li><strong>Database Caching</strong>: Includes query results, indexes, and materialized views.</li>
<li><strong>Memoization</strong>: Caches the results of expensive function calls, useful in dynamic programming.</li>
</ol>
<h2 id="deployment-models-">Deployment Models üöÄ<a hidden class="anchor" aria-hidden="true" href="#deployment-models-">#</a></h2>
<p>Caches can be deployed as:</p>
<ul>
<li><strong>In-Memory</strong>: Fast, as data resides in RAM. Examples include Memcached and Redis.</li>
<li><strong>Distributed</strong>: For scalability and fault tolerance, data is distributed across multiple nodes.</li>
</ul>
<h2 id="cache-management-">Cache Management üõ°Ô∏è<a hidden class="anchor" aria-hidden="true" href="#cache-management-">#</a></h2>
<h3 id="eviction-policies-">Eviction Policies üö™<a hidden class="anchor" aria-hidden="true" href="#eviction-policies-">#</a></h3>
<p>When cache memory is full, items must be evicted. Common strategies include:</p>
<ul>
<li><strong>Least Recently Used (LRU)</strong>: Removes the least recently accessed item.</li>
<li><strong>First-In-First-Out (FIFO)</strong>: Removes the oldest entry.</li>
<li><strong>Least Frequently Used (LFU)</strong>: Removes the least accessed item.</li>
</ul>
<h3 id="caching-strategies-">Caching Strategies üß©<a hidden class="anchor" aria-hidden="true" href="#caching-strategies-">#</a></h3>
<h4 id="inline-caches-">Inline Caches üõ§Ô∏è<a hidden class="anchor" aria-hidden="true" href="#inline-caches-">#</a></h4>
<ol>
<li><strong>Read-Through</strong>: Cache retrieves data from storage on a miss and serves it to the client.</li>
<li><strong>Write-Through</strong>: Updates are written to both the cache and storage simultaneously.</li>
<li><strong>Write-Back</strong>: Updates are written to the cache first and later synced to storage, offering better write performance but weaker consistency.</li>
</ol>
<h4 id="side-caches-">Side Caches üõ†Ô∏è<a hidden class="anchor" aria-hidden="true" href="#side-caches-">#</a></h4>
<ol>
<li><strong>Cache-Aside</strong>: The application explicitly manages cache reads and writes.</li>
<li><strong>Write-Around</strong>: Data is written directly to storage without updating the cache, suitable for rarely updated data.</li>
</ol>
<h2 id="common-challenges-">Common Challenges üõë<a hidden class="anchor" aria-hidden="true" href="#common-challenges-">#</a></h2>
<h3 id="thundering-herd-problem-">Thundering Herd Problem üêò<a hidden class="anchor" aria-hidden="true" href="#thundering-herd-problem-">#</a></h3>
<p>Occurs when multiple clients overwhelm the system after a cache miss. Solutions include:</p>
<ol>
<li><strong>Cache Warm-Up</strong>: Pre-load frequently accessed data.</li>
<li><strong>Soft and Hard TTL</strong>: Extend cache validity with soft TTL to avoid simultaneous cache expirations.</li>
</ol>
<h3 id="cache-penetration-">Cache Penetration üö´<a hidden class="anchor" aria-hidden="true" href="#cache-penetration-">#</a></h3>
<p>Happens when requests repeatedly query non-existent data. Solutions include <strong>negative caching</strong> to store &ldquo;non-existent&rdquo; responses temporarily.</p>
<h3 id="hot-key-problem-">Hot Key Problem üî•<a hidden class="anchor" aria-hidden="true" href="#hot-key-problem-">#</a></h3>
<p>A single, heavily accessed cache entry can overwhelm a single node. Solutions include sharding the cache or using distributed caching.</p>
<hr>
<p>Caching is a critical tool in system design that can significantly enhance performance when applied correctly. Understanding where, when, and how to use caching will help you optimize systems and ace system design interviews.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/post2/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>Want to learn AWS? Start here.</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="http://localhost:1313/">Sergei Bozhko</a></span> ¬∑ 

</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script></body>

</html>
